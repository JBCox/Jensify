<div class="dashboard-container">
  <!-- Header -->
  <div class="dashboard-header">
    <div class="header-content">
      <h1>Team Dashboard</h1>
      <p class="subtitle">Review approvals and monitor team spending</p>
    </div>
    <div class="header-actions">
      <button mat-raised-button color="primary" (click)="onViewApprovals()">
        <mat-icon>task_alt</mat-icon>
        View All Approvals
      </button>
    </div>
  </div>

  @if (metrics$ | async; as metrics) {
  <!-- Compact Stats Bar -->
  <div class="stats-bar">
    <div class="stat-item" [class.attention]="metrics.teamPendingApprovals > 0">
      <mat-icon>pending_actions</mat-icon>
      <span class="stat-value">{{ metrics.teamPendingApprovals }}</span>
      <span class="stat-label">Pending</span>
    </div>
    <div class="stat-divider"></div>
    <div class="stat-item">
      <mat-icon>payments</mat-icon>
      <span class="stat-value">{{ formatCurrency(metrics.teamMonthSpend) }}</span>
      <span class="stat-label">Team MTD</span>
      @if (metrics.spendChange > 0) {
        <span class="stat-change" [class.negative]="metrics.spendChangeType === 'negative'" [class.positive]="metrics.spendChangeType === 'positive'">
          {{ metrics.spendChangeType === 'negative' ? '+' : '-' }}{{ metrics.spendChange }}%
        </span>
      }
    </div>
    <div class="stat-divider"></div>
    <div class="stat-item">
      <mat-icon>receipt_long</mat-icon>
      <span class="stat-value">{{ metrics.myPendingExpenses }}</span>
      <span class="stat-label">My Pending</span>
    </div>
    <div class="stat-divider"></div>
    <div class="stat-item">
      <mat-icon>people</mat-icon>
      <span class="stat-value">{{ metrics.teamMemberCount }}</span>
      <span class="stat-label">Team</span>
    </div>
  </div>

  <!-- Analytics Section -->
  <div class="analytics-section">
    <div class="section-header">
      <h2><mat-icon>insights</mat-icon> Team Analytics</h2>
    </div>

    <div class="charts-row">
      <!-- Team Spending by Category -->
      <div class="chart-card">
        <div class="chart-header">
          <div class="chart-title">
            <mat-icon>donut_large</mat-icon>
            <span>By Category</span>
          </div>
          <span class="chart-period">This Month</span>
        </div>
        <div class="chart-body">
          @if (teamCategorySpendData$ | async; as categoryData) {
            @if (categoryData.length > 0) {
              <ngx-charts-pie-chart
                [results]="categoryData"
                [scheme]="pieColorScheme"
                [legend]="true"
                [legendPosition]="legendPosition"
                [labels]="false"
                [doughnut]="true"
                [gradient]="true"
                [animations]="true">
              </ngx-charts-pie-chart>
            } @else {
              <div class="chart-empty">
                <mat-icon>pie_chart_outline</mat-icon>
                <span>No team expenses this month</span>
              </div>
            }
          }
        </div>
      </div>

      <!-- Team Spending Trend -->
      <div class="chart-card">
        <div class="chart-header">
          <div class="chart-title">
            <mat-icon>show_chart</mat-icon>
            <span>Spending Trend</span>
          </div>
          <span class="chart-period">Last 6 Months</span>
        </div>
        <div class="chart-body">
          @if (teamSpendTrendData$ | async; as trendData) {
            @if (hasTrendData(trendData)) {
              <ngx-charts-line-chart
                [results]="trendData"
                [scheme]="lineChartColorScheme"
                [xAxis]="true"
                [yAxis]="true"
                [showXAxisLabel]="false"
                [showYAxisLabel]="false"
                [autoScale]="true"
                [gradient]="true"
                [animations]="true">
              </ngx-charts-line-chart>
            } @else {
              <div class="chart-empty">
                <mat-icon>trending_up</mat-icon>
                <span>No historical data yet</span>
              </div>
            }
          }
        </div>
      </div>
    </div>
  </div>
  }

  <!-- Two Column Layout: Pending Approvals & My Expenses -->
  <div class="content-grid">
    <!-- Team Pending Approvals -->
    <div class="activity-section">
      <div class="section-header">
        <h2><mat-icon>task_alt</mat-icon> Pending Approvals</h2>
        <button mat-button color="primary" (click)="onViewApprovals()">View All</button>
      </div>

      @if (teamPendingApprovals$ | async; as approvals) {
        @if (approvals.length > 0) {
          <div class="expense-list">
            @for (expense of approvals; track expense.id) {
              <div class="expense-row" (click)="onViewExpense(expense)">
                <div class="expense-icon user-icon">
                  <mat-icon>account_circle</mat-icon>
                </div>
                <div class="expense-info">
                  <span class="submitter">{{ getUserName(expense) }}</span>
                  <span class="merchant">{{ expense.merchant || 'No merchant' }}</span>
                </div>
                <div class="expense-amount">{{ formatCurrency(expense.amount) }}</div>
                <div class="expense-actions">
                  <button mat-button color="primary" (click)="onViewExpense(expense)" title="Review expense details">
                    <mat-icon>open_in_new</mat-icon>
                    Review
                  </button>
                </div>
              </div>
            }
          </div>
        } @else {
          <app-empty-state
            icon="task_alt"
            title="No Pending Approvals"
            message="Your team has no expenses waiting for approval">
          </app-empty-state>
        }
      }
    </div>

    <!-- My Recent Expenses -->
    <div class="activity-section">
      <div class="section-header">
        <h2><mat-icon>receipt_long</mat-icon> My Expenses</h2>
        <button mat-button color="primary" (click)="onViewMyExpenses()">View All</button>
      </div>

      @if (myRecentExpenses$ | async; as expenses) {
        @if (expenses.length > 0) {
          <div class="expense-list">
            @for (expense of expenses; track expense.id) {
              <div class="expense-row" (click)="onViewExpense(expense)">
                <div class="expense-icon">
                  <mat-icon>receipt</mat-icon>
                </div>
                <div class="expense-info">
                  <span class="merchant">{{ expense.merchant || 'No merchant' }}</span>
                  <span class="date">{{ formatDate(expense.expense_date) }}</span>
                </div>
                <div class="expense-amount">{{ formatCurrency(expense.amount) }}</div>
                <app-status-badge [status]="mapStatus(expense.status)" size="small"></app-status-badge>
              </div>
            }
          </div>
        } @else {
          <app-empty-state
            icon="receipt_long"
            title="No Expenses Yet"
            message="Upload your first receipt to get started"
            actionLabel="Upload Receipt"
            actionIcon="camera_alt"
            routerLink="/expenses/upload">
          </app-empty-state>
        }
      }
    </div>
  </div>
</div>
