<div class="jensify-container">
  <!-- Pull to Refresh (mobile only) -->
  <app-pull-to-refresh
    [refreshing]="loading()"
    (refresh)="loadReports()">
  </app-pull-to-refresh>

  <!-- Page Header -->
  <div class="jensify-page-header">
    <div>
      <h1 class="jensify-page-title">Expense Reports</h1>
      <p class="jensify-page-subtitle">Group multiple expenses into reports for batch submission</p>
    </div>
    <button
      mat-raised-button
      color="primary"
      (click)="createReport()"
      class="jensify-button">
      <mat-icon>add</mat-icon>
      New Report
    </button>
  </div>

  <!-- Filters -->
  <mat-card class="jensify-card jensify-filters-card">
    <div class="jensify-filters">
      <mat-form-field appearance="fill" floatLabel="always" class="jensify-search-field">
        <mat-label>Search reports</mat-label>
        <mat-icon matPrefix>search</mat-icon>
        <input matInput [formControl]="searchControl" placeholder="Search by name or description...">
      </mat-form-field>

      <mat-form-field appearance="fill" floatLabel="always" class="jensify-filter-field">
        <mat-label>Status</mat-label>
        <mat-select [formControl]="statusFilter">
          @for (option of statusOptions; track option.value) {
            <mat-option [value]="option.value">{{ option.label }}</mat-option>
          }
        </mat-select>
      </mat-form-field>
    </div>
  </mat-card>

  <!-- Loading State -->
  @if (loading()) {
    <div class="jensify-loading">
      <mat-progress-spinner mode="indeterminate"></mat-progress-spinner>
      <p>Loading reports...</p>
    </div>
  }

  <!-- Error State -->
  @if (error()) {
    <mat-card class="jensify-card jensify-message-error">
      <mat-icon>error</mat-icon>
      <div>
        <h3>Unable to load reports</h3>
        <p>{{ error() }}</p>
        <button mat-stroked-button color="primary" (click)="loadReports()" class="jensify-button">Try Again</button>
      </div>
    </mat-card>
  }

  <!-- Empty State -->
  @if (!loading() && !error() && filteredReports().length === 0) {
    @if (reports().length === 0) {
      <!-- No reports at all -->
      <app-empty-state
        icon="folder_open"
        title="No expense reports yet"
        message="Create your first report to group multiple expenses together"
        [actionLabel]="'Create Report'"
        (action)="createReport()">
      </app-empty-state>
    } @else {
      <!-- No reports matching filters -->
      <app-empty-state
        icon="filter_list_off"
        title="No reports match your filters"
        message="Try adjusting your search or filter criteria">
      </app-empty-state>
    }
  }

  <!-- Reports List -->
  @if (!loading() && !error() && filteredReports().length > 0) {
    <div class="reports-grid">
      @for (report of filteredReports(); track report.id) {
        <mat-card class="report-card jensify-card" (click)="viewReport(report)">
          <!-- Card Header -->
          <div class="card-header">
            <div class="header-left">
              <h3 class="report-name">{{ report.name }}</h3>
              @if (report.description) {
                <p class="report-description">{{ report.description }}</p>
              }
            </div>
            <app-status-badge [status]="getBadgeStatus(report.status)"></app-status-badge>
          </div>

          <!-- Card Content -->
          <div class="card-content">
            <!-- Expense Count -->
            <div class="info-row">
              <mat-icon class="info-icon">receipt</mat-icon>
              <span class="info-label">{{ getExpenseCount(report) }} expense{{ getExpenseCount(report) !== 1 ? 's' : '' }}</span>
            </div>

            <!-- Date Range -->
            @if (report.start_date || report.end_date) {
              <div class="info-row">
                <mat-icon class="info-icon">date_range</mat-icon>
                <span class="info-label">
                  {{ formatDate(report.start_date) }} - {{ formatDate(report.end_date) }}
                </span>
              </div>
            }

            <!-- Created Date -->
            <div class="info-row">
              <mat-icon class="info-icon">schedule</mat-icon>
              <span class="info-label">Created {{ formatDate(report.created_at) }}</span>
            </div>

            <!-- Total Amount -->
            <div class="total-amount">
              <span class="amount-label">Total:</span>
              <span class="amount-value">{{ formatCurrency(report.total_amount) }}</span>
            </div>
          </div>

          <!-- Card Actions -->
          <div class="card-actions">
            <!-- Submit Button (Draft only) -->
            @if (canSubmit(report)) {
              <button
                mat-flat-button
                color="primary"
                (click)="submitReport(report, $event)"
                class="jensify-button">
                <mat-icon>send</mat-icon>
                Submit
              </button>
            }

            <!-- Delete Button (Draft only) -->
            @if (canDelete(report)) {
              <button
                mat-icon-button
                color="warn"
                (click)="deleteReport(report, $event)"
                matTooltip="Delete report"
                class="delete-button">
                <mat-icon>delete</mat-icon>
              </button>
            }

            <!-- View Button -->
            <button
              mat-stroked-button
              (click)="viewReport(report)"
              class="jensify-button">
              <mat-icon>visibility</mat-icon>
              View
            </button>
          </div>
        </mat-card>
      }
    </div>
  }
</div>
