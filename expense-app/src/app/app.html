<ng-container *ngIf="vm$ | async as vm">
<!-- Top Bar - Show only when user is authenticated -->
<mat-toolbar *ngIf="vm.isAuthenticated && !isAuthRoute" class="app-toolbar">
  <div class="toolbar-content">
    <!-- Left Section: Hamburger + Logo -->
    <div class="toolbar-left">
      <button mat-icon-button class="hamburger-button" (click)="toggleSidebar()" aria-label="Toggle sidebar">
        <mat-icon>menu</mat-icon>
      </button>
      <div class="logo-section">
        <mat-icon class="logo-icon">receipt_long</mat-icon>
        <span class="app-name">Jensify</span>
      </div>
    </div>

    <!-- Center Section: Search Placeholder -->
    <div class="toolbar-center">
      <div class="search-placeholder">
        <mat-icon>search</mat-icon>
        <span>Search expenses...</span>
      </div>
    </div>

    <!-- Right Section: Notifications + User Menu -->
    <div class="toolbar-right">
      <app-notification-center></app-notification-center>

      <button mat-icon-button [matMenuTriggerFor]="userMenu" aria-label="User menu">
        <mat-icon>account_circle</mat-icon>
      </button>
      <mat-menu #userMenu="matMenu">
        <div class="user-info" mat-menu-item disabled>
          <div class="user-name">{{ vm.displayName }}</div>
          <div class="user-email">{{ vm.email }}</div>
        </div>
        <mat-divider></mat-divider>
        <button mat-menu-item (click)="signOut()">
          <mat-icon>logout</mat-icon>
          <span>Sign Out</span>
        </button>
      </mat-menu>
    </div>
  </div>
</mat-toolbar>

<!-- Sidebar Navigation -->
<app-sidebar-nav
  *ngIf="vm.isAuthenticated && !isAuthRoute"
  [isOpen]="isSidebarOpen"
  (closeSidebar)="closeSidebar()">
</app-sidebar-nav>

<!-- Main Content Area -->
<div
  class="app-content jensify-premium-mesh-bg"
  [class.with-toolbar]="vm.isAuthenticated && !isAuthRoute"
  [class.with-sidebar]="vm.isAuthenticated && !isAuthRoute">
  <!-- Breadcrumbs -->
  <app-breadcrumbs *ngIf="vm.isAuthenticated && !isAuthRoute"></app-breadcrumbs>

  <router-outlet />
</div>
</ng-container>

<!-- PWA Components (always visible) -->
<app-offline-indicator />
<app-install-prompt />
